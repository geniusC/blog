---
layout: chsx
titile: A*寻路算法的理解和实践
tags: a* astar 寻路算法 
---

A*寻路算法的理解和实践
====

介绍
------

A* 算法也称A star算法，是一种启发式寻路算法，在游戏开发中广泛应用。使用A* 算法能够快速地找到一条比较合适的路径。

 ![效果]({{"/assets/image/20170923astar/0Y6W@~VH]{UU_5J0HW76%%6.png" | absolute_url}})


原理
------
设某个点到起点的耗费为h(n),到终点的耗费为g(n)，则该点可用
```
f(n) = h(n) + g(n)
```
表示该点的代价，其中启发式距离g(n)有多种算法

1. 曼哈顿距离 
    两个点横坐标差的绝对值之和乘以系数
    ```
    g(n) = D * (abs(n.x - destination.x) + abs(n.y -destination.y))
    ```
2. 欧几里得距离
    两个点指点的直线距离
    ```
    g(n) = D * sqrt(abs(n.x - destination.x) ^ 2 + (n.y - destination.y))
    ```

系数D取决于你设计的系统，由你自己来设定。
g(n)还有其他多种计算方式，如对角线距离、平方后的欧几里得距离等。

h(n)表示起点到该点已经产生的代价，如果向每个方向移动一个单位产生的代价都为p,则h(n) = p * 起点移动到该点的移动次数

寻路步骤
------
为了方便的计算h(n)以及记录路径，我们为每个节点都设置父节点。新的节点h(n) = 父节点的h(n) + 父亲节点移动到该节点的代价
建立开启列表和关闭列表来存储地图上的节点

1. 将起点加入关闭列表
2. 遍历起点附近的节点，将节点的父节点设置为起点并加入开启列表
3. 从开启列表中取代价f(n)最小的节点，遍历该节点附近所有节点,将会有四种可能。
    * 如果附近节点为障碍物(不可到达)，则直接跳过
    * 如果附近节点在关闭列表中，则直接跳过。
    * 如果附近节点不在关闭列表且不在开启列表中， 则将附近节的父节点设置为该节点并加入开启列表
    * 如果附近节点已经在开启列表中，则比较附近节点h(n')与该节点h(n)+ p(该节点移动到附近节点的代价)，如果h(n') > h(n) + p,则将附近的节点的父节点设置为该节点。
4. 重复步骤3，直至找到目标点或者开启列表为空
5. 如果找到目标点，则从目标节点开始，依次将父节点压栈直至父节点为空，栈里保存的就是寻找到的路径。

实践
------
 ![运行]({{"/assets/image/20170923astar/astar.gif" | absolute_url}})

 * [源码以及二进制文件下载](https://github.com/geniusC/ctoy/raw/master/AStar%E5%AF%BB%E8%B7%AF%E7%AE%97%E6%B3%95/astar.rar)