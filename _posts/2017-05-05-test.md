---
layout: post
title: wsgi+nginx部署django项目
---
<h2>{{ page.title }}</h2>
因为django版本的问题,看了很多篇博客弄了几天也没能部署成功(也可能是个人能力问题) 最后自己摸索着成功部署.

1.安装 wsgi和nginx
apt-get install uwsgi

apt-get install nginx

2.运行开发服务器来确保项目自身没有问题
python manage.py runserver

3.使用wsgi拉起项目
uwsgi --http :8001 --chdir /path/to/project --module project.wsgi

在浏览器输入地址确保wsgi正常

到这一步已经能够正常访问了 但是 每次这样输入命令太长了  所以我们在项目根目录下建立文件wsgi.ini

[uwsgi]
socket = localhost:8003                                       //uwsgi的端口号  之后在nginx会与之对接
chdir=/path/to/project
module=project.wsgi:application
master=True
pidfile=/tmp/project-master.pid
vacuum=True
max-requests=5000
daemonize=/path/to/project/projectlog

好了 到这里我们已经能够使用非常短的命令来启动了

uwsgi --ini wsgi.ini

4.配置nginx
在/etc/nginx/site-available/下创建新文件project.conf

upstream chinsblog_uwsgi {
        server localhost:8003;            //与之前配置的wsgi对接
}
server {
        listen   8001;
        server_name localhost;
        charset  utf-8;
        client_max_body_size 75M;
        location /media  {
                alias /home/media;                //你的图片等文件路径
        }
        location /static {
                alias /home/static;               //静态文件路径
        }
        location / {
                uwsgi_pass project_uwsgi;
                include /etc/nginx/uwsgi_params;
  }
}

然后做一个链接

sudo ln -s /etc/nginx/sites-available/project.conf    /etc/nginx/sites-enabled/projcet.conf

重启一下nginx

service nginx restart

好了  就这样部署成功了

5.使用supervisor守护进程
为了网站更加稳定 可以使用 supervisor来守护进程

sudo apt-get install supervisor

生成默认的supervisor配置文件

echo_supervisord_conf > /etc/supervisord.conf

在supervisord.conf配置文件末尾加入

[program:project]
command= uwsgi --ini /path/to/project/uwsgi.ini                  //之前配置的uwsgi文件
startsecs=0
stopwaitsecs=0
autostart=true
autorestart=true
启动supervisor服务

supervisord -c /etc/supervisord.conf

启动项目

supervisorctl -c /etc/supervisord.conf start project